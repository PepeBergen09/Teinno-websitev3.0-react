# Additional security configuration for nginx
# This file should be included in the main nginx configuration

# Hide nginx version
server_tokens off;

# Set security headers
more_set_headers "X-Frame-Options: SAMEORIGIN";
more_set_headers "X-XSS-Protection: 1; mode=block";
more_set_headers "X-Content-Type-Options: nosniff";
more_set_headers "Referrer-Policy: no-referrer-when-downgrade";
more_set_headers "Strict-Transport-Security: max-age=31536000; includeSubDomains; preload";

# Prevent access to sensitive files
location ~ /\.(ht|git|svn) {
    deny all;
    access_log off;
    log_not_found off;
}

# Prevent access to backup and temporary files
location ~* \.(bak|backup|old|orig|tmp|temp|swp|swo|log)$ {
    deny all;
    access_log off;
    log_not_found off;
}

# Prevent access to configuration files
location ~* \.(conf|config|ini|env)$ {
    deny all;
    access_log off;
    log_not_found off;
}

# Rate limiting for API endpoints (if any)
location /api/ {
    limit_req zone=api burst=5 nodelay;
    limit_req_status 429;
}

# Prevent hotlinking
location ~* \.(gif|png|jpe?g|svg|ico|pdf|zip|rar|exe|flv|mov|wma|mp3|mp4|swf)$ {
    valid_referers none blocked server_names *.teinno.com teinno.com;
    if ($invalid_referer) {
        return 403;
    }
}

# Block common attack patterns
location ~* (eval\(|base64_|javascript:|vbscript:|onload=|onerror=) {
    deny all;
    access_log off;
    log_not_found off;
}

# Block SQL injection attempts
location ~* (union.*select|insert.*into|delete.*from|drop.*table) {
    deny all;
    access_log off;
    log_not_found off;
}